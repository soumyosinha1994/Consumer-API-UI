<!-- ================= Input Card ================= -->
<mat-card class="w-96 p-4">
  <h3>Get Consumer Fields</h3>

  <form [formGroup]="form">
    <mat-form-field class="w-full">
      <mat-label>Content ID</mat-label>
      <input matInput formControlName="contentId" />
    </mat-form-field>

    <button
      mat-raised-button
      color="primary"
      (click)="getFields()">
      Get Fields
    </button>
  </form>
</mat-card>

<!-- ================= SIMPLE FIELDS ================= -->
@if (flattenedSimpleFields.length > 0) {
  <mat-card class="mt-6 p-4">
    <h4>Simple Fields</h4>

    <table
      mat-table
      [dataSource]="flattenedSimpleFields"
      class="mat-elevation-z2 w-full mt-2">

      @for (column of displayedColumns; track column) {

        <ng-container [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef>
            {{ column | titlecase }}
          </th>

          <td mat-cell *matCellDef="let row">
            {{ row[column] }}
          </td>
        </ng-container>

      }

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    </table>
  </mat-card>
}

<!-- ================= COMPLEX FIELDS ================= -->
@if (response?.result?.complexFields?.length > 0) {
  <mat-card class="mt-6 p-4">
    <h4>Complex Fields</h4>

    @for (complex of response.result.complexFields; track complex.id) {

      <mat-card class="mt-4 p-3 mat-elevation-z1">
        <h5>
          {{ complex.complexFieldType?.localizedName || 'Unnamed Complex Field' }}
        </h5>

        @if (complex.simpleFields?.length > 0) {

          <table
            mat-table
            [dataSource]="complex.simpleFields"
            class="mat-elevation-z1 w-full mt-2">

            @for (column of displayedColumns; track column) {
              <ng-container [matColumnDef]="column">
                <th mat-header-cell *matHeaderCellDef>
                  {{ column }}
                </th>

                <td mat-cell *matCellDef="let row">
                  {{ row[column] | json }}
                </td>
              </ng-container>
            }

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        }

        @if (!complex.simpleFields?.length) {
          <p class="text-gray-500 mt-2">No simple fields inside this complex field.</p>
        }
      </mat-card>
    }
  </mat-card>
}

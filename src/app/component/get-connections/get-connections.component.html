<!-- ================= Header ================= -->
<div class="page-header">
  <h3>Connections Details</h3>

  <button style="float: right;"
    mat-raised-button
    color="primary"
    (click)="showCreateForm = !showCreateForm">
    + Create New Connection
  </button>
</div>
<!-- ================= CREATE CONNECTION FORM ================= -->
@if (showCreateForm) {
  <mat-card class="mt-4 p-4" style="margin-bottom: 50px;">
    <h4>Create Connection</h4>

    <form [formGroup]="createForm" class="grid grid-cols-2 gap-4">

      <mat-form-field>
        <mat-label>Connection Name</mat-label>
        <input matInput formControlName="connectionName" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Description</mat-label>
        <input matInput formControlName="description" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Integration ID</mat-label>
        <input matInput formControlName="integrationId" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Environment ID</mat-label>
        <input matInput formControlName="environmentId" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Plugin Type</mat-label>
        <input matInput formControlName="pluginType" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Plugin ID</mat-label>
        <input matInput formControlName="pluginId" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Transport Type</mat-label>
        <input matInput formControlName="transportType" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Service URL</mat-label>
        <input matInput formControlName="serviceUrl" />
      </mat-form-field>

      <div class="col-span-2 flex gap-4">
        <button
          mat-raised-button
          color="primary"
          (click)="submitCreateConnection()"
          [disabled]="createForm.invalid || loading">
          Create
        </button>

        <button
          mat-button
          color="warn"
          (click)="showCreateForm = false">
          Cancel
        </button>
      </div>
    </form>
  </mat-card>
}
<!-- ================= Input Card ================= -->
<mat-card class="w-96 p-4">
  <form [formGroup]="form">
    <mat-form-field class="w-full">
      <mat-label>Connection ID (optional)</mat-label>
      <input matInput formControlName="connectionId" />
    </mat-form-field>

    <button
      mat-raised-button
      color="accent"
      (click)="getConnections()"
      [disabled]="loading">
      Get Connections
    </button>
  </form>
</mat-card>

<!-- ================= Loader ================= -->
@if (loading) {
  <div class="page-loader">
    <mat-progress-spinner diameter="56" mode="indeterminate"></mat-progress-spinner>
  </div>
}

<!-- ================= CONNECTIONS TABLE ================= -->
@if (!loading && rows.length > 0) {
  <mat-card class="mt-6 p-4">
    <h4>Connections</h4>
<div class="table-wrapper">
      <table mat-table [dataSource]="rows" class="mat-elevation-z2 w-full mt-2">

      <!-- Dynamic columns -->
      @for (column of displayedColumns; track column) {
        <ng-container [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef>{{ column | titlecase }}</th>
          <td mat-cell *matCellDef="let row">{{ row[column] }}</td>
        </ng-container>
      }

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let row">
          <button mat-button color="primary" (click)="viewConnection(row.connectionId)">
            View
          </button>
          <button mat-button color="warn" (click)="deleteConnection(row.connectionId)">
            Delete
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsWithActions"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsWithActions"></tr>
    </table>
</div>

    <mat-paginator
      [pageSizeOptions]="[5, 10, 25, 50]"
      [pageSize]="10"
      showFirstLastButtons>
    </mat-paginator>
  </mat-card>
}

@if (!loading && rows.length === 0) {
  <mat-card class="mt-6 p-4 text-gray-500">
    No connections found.
  </mat-card>
}
